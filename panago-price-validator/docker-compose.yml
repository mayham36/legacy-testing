services:
  # Web UI - default service
  web:
    build: .
    ports:
      - "8080:8080"
    volumes:
      - ./input:/app/input
      - ./output:/app/output
      - ./config:/app/config
    environment:
      - PYTHONUNBUFFERED=1
    # Default: run web UI
    command: ["--web", "--port", "8080"]

  # CLI validator against QA
  validator:
    build: .
    volumes:
      # Mount input/output directories for easy access
      - ./input:/app/input
      - ./output:/app/output
      - ./config:/app/config
    environment:
      - PYTHONUNBUFFERED=1
    # Run CLI against QA with safe mode
    command: ["-i", "input/expected_prices.xlsx", "--env", "qa"]
    profiles:
      - cli

  # CLI service for running against production
  validator-production:
    build: .
    volumes:
      - ./input:/app/input
      - ./output:/app/output
      - ./config:/app/config
    environment:
      - PYTHONUNBUFFERED=1
    command: ["-i", "input/expected_prices.xlsx", "--env", "production"]
    profiles:
      - production

  # CLI service for running a single province
  validator-bc-only:
    build: .
    volumes:
      - ./input:/app/input
      - ./output:/app/output
      - ./config:/app/config
    environment:
      - PYTHONUNBUFFERED=1
    command: ["-i", "input/expected_prices.xlsx", "--env", "qa", "--province", "BC"]
    profiles:
      - bc-only
